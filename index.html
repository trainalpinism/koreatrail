<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>카카오맵 커스텀 마커</title>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=19f1385bacd7bf7d9e5c7804cc8154ce&libraries=clusterer"></script>
    <style>
        #map { width: 100%; height: 1000px; }
    </style>
</head>
<body>
    <h3>카카오맵 지도</h3>
    <div id="map"></div>

    <script>
        // 지도 중심과 확대 수준 설정
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.41020233137107, 126.6796163126106), // 지도 중심 좌표
            level: 7 // 확대 수준
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 동그라미 모양의 마커 아이콘 생성 함수
        function createCircleIcon() {
            return new kakao.maps.MarkerImage(
                'data:image/svg+xml;utf-8,' + encodeURIComponent(`
                    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="15" cy="15" r="12" fill="red" stroke="white" stroke-width="3"/>
                    </svg>`), // 동그라미 SVG
                new kakao.maps.Size(30, 30), // 크기 설정
                { offset: new kakao.maps.Point(15, 15) } // 마커 중심 설정
            );
        }

        // 마커 위치와 정보 데이터
        var positions = [
            { lat: 37.475379766747466, lon: 126.64437130808757, memo: "(송림동)해장국집" },
            { lat: 37.475631855098, lon: 126.61971623735018, memo: "연경" },
            { lat: 37.40938869192894, lon: 126.69389136724412, memo: "1층 공단떡볶이 / 2층 백암왕순" },
            { lat: 37.44020233137107, lon: 126.6996163126106, memo: "대전" }
        ];

        // 마커 배열
        var markers = [];

        // 각 위치에 마커 생성
        positions.forEach(function(position) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(position.lat, position.lon),
                image: createCircleIcon() // 동그라미 모양 마커 아이콘
            });

            // 마커 클릭 시 메모(InfoWindow) 표시 및 토글 기능 구현
            var infoWindow = new kakao.maps.InfoWindow({
                content: `<div style="padding:5px;">${position.memo}</div>`,
                removable: true // 닫기 버튼 추가
            });

            var isOpen = false; // InfoWindow 열림 상태 추적

            // 마커 클릭 시 토글로 메모 열기/닫기
            kakao.maps.event.addListener(marker, 'click', function() {
                if (isOpen) {
                    infoWindow.close();
                } else {
                    infoWindow.open(map, marker);
                }
                isOpen = !isOpen;
            });

            markers.push(marker);
        });

        // 마커 클러스터러 설정
        var clusterer = new kakao.maps.MarkerClusterer({
            map: map,
            averageCenter: true, // 클러스터링 시 중앙을 평균으로
            minLevel: 7 // 클러스터링이 적용되는 최소 줌 레벨
        });

        // 클러스터러에 마커 추가
        clusterer.addMarkers(markers);

    </script>
</body>
</html>
